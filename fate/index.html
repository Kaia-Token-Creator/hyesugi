<!DOCTYPE html>
<html lang="ko">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QR5TWB3RYJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QR5TWB3RYJ');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9891583086388017" crossorigin="anonymous"></script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>혜숙이의 상담소 - 사주풀이</title>
<meta name="description" content="상담가이자 다정한 친구, ‘혜숙이’가 당신의 사주를 풀어드립니다." />
<link rel="canonical" href="https://hyesugi.com/" />
<meta name="robots" content="index,follow" />
<meta name="theme-color" content="#9bbbd4" />

<!-- Favicon & App Icons -->
<link rel="icon" href="https://hyesugi.com/favicon.ico" sizes="any" />
<link rel="apple-touch-icon" href="https://hyesugi.com/apple-touch-icon.png" sizes="180x180" />
<link rel="manifest" href="https://hyesugi.com/site.webmanifest" />

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:site_name" content="hyesugi.com" />
<meta property="og:url" content="https://hyesugi.com/" />
<meta property="og:title" content="혜숙이의 사주풀이" />
<meta property="og:description" content="‘혜숙이’가 사주를 풀어드립니다" />
<meta property="og:image" content="https://hyesugi.com/og-image.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content="혜숙이 상담 화면 미리보기" />

<!-- Twitter (X) Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="혜숙이의 사주풀이" />
<meta name="twitter:description" content="다정한 사주전문가 ‘혜숙이’와 대화해 보세요." />
<meta name="twitter:image" content="https://hyesugi.com/og-image.jpg" />

<link rel="preload" as="image" href="https://hyesugi.com/preview.jpg" imagesrcset="https://hyesugi.com/preview.jpg" />

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white font-sans">
  <div id="app" class="flex flex-col min-h-screen max-w-3xl mx-auto bg-[#9bbbd4]">

    <!-- Header + 햄버거 메뉴 버튼 -->
    <header class="bg-white/30 backdrop-blur-sm text-center py-4 shadow-md relative">
      <h1 class="text-xl font-bold text-gray-800 flex items-center justify-center gap-2">
        <a href="https://hyesugi.com" class="flex items-center justify-center gap-2" aria-label="hyesugi.com으로 이동">
          <img src="https://hyesugi.com/hyesugi.jpg" alt="혜숙이" class="w-14 h-14 rounded-full object-cover">
          당신의 상담친구 혜숙이
        </a>
      </h1>
      <p class="text-sm text-gray-600">나의 사주는</p>

      <!-- 햄버거 버튼 -->
      <button id="menu-btn" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-white/60 focus:outline-none focus:ring-2 focus:ring-black/40" aria-label="메뉴 열기">
        <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"/>
        </svg>
      </button>
    </header>

    <!-- 본문 -->
    <main id="content" class="flex-1 p-4">
      <!-- 🔮 나의 사주는 / 궁합 -->
      <section class="mx-auto max-w-xl bg-white/70 backdrop-blur-sm rounded-2xl p-5 shadow">
        <h2 class="text-lg font-bold text-gray-900 mb-4">나의 사주는 / 궁합</h2>

        <!-- 라디오 토글 -->
        <div class="mb-4 inline-flex rounded-full bg-white p-1 ring-1 ring-black/10 select-none">
          <label class="cursor-pointer">
            <input type="radio" name="mode" value="saju" class="hidden peer" checked>
            <span class="px-4 py-2 rounded-full text-sm font-semibold peer-checked:bg-black peer-checked:text-white">사주</span>
          </label>
          <label class="cursor-pointer">
            <input type="radio" name="mode" value="match" class="hidden peer">
            <span class="px-4 py-2 rounded-full text-sm font-semibold peer-checked:bg-black peer-checked:text-white">궁합</span>
          </label>
        </div>

        <form id="saju-form" class="space-y-4">
          <!-- A(나) -->
          <fieldset class="space-y-3">
            <legend class="text-sm font-semibold text-gray-900">내 정보</legend>

            <div>
              <label for="birthDate" class="block text-sm font-medium text-gray-800">생년월일 (양력)</label>
              <input id="birthDate" name="birthDate" type="date" required
                     class="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black/30 bg-white" />
            </div>

            <div class="flex items-center gap-3">
              <div class="flex-1">
                <label for="birthTime" class="block text-sm font-medium text-gray-800">출생 시간</label>
                <input id="birthTime" name="birthTime" type="time" step="60"
                       class="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black/30 bg-white" />
              </div>
              <label class="mt-6 inline-flex items-center gap-2 select-none">
                <input id="unknownTime" type="checkbox" class="w-4 h-4">
                <span class="text-sm text-gray-800">모름</span>
              </label>
            </div>
          </fieldset>

          <!-- B(상대) — 궁합 모드에서만 표시 -->
          <fieldset id="partner-fields" class="space-y-3 hidden">
            <legend class="text-sm font-semibold text-gray-900">상대 정보</legend>

            <div>
              <label for="birthDate2" class="block text-sm font-medium text-gray-800">생년월일 (양력)</label>
              <input id="birthDate2" name="birthDate2" type="date"
                     class="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black/30 bg-white" />
            </div>

            <div class="flex items-center gap-3">
              <div class="flex-1">
                <label for="birthTime2" class="block text-sm font-medium text-gray-800">출생 시간</label>
                <input id="birthTime2" name="birthTime2" type="time" step="60"
                       class="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black/30 bg-white" />
              </div>
              <label class="mt-6 inline-flex items-center gap-2 select-none">
                <input id="unknownTime2" type="checkbox" class="w-4 h-4">
                <span class="text-sm text-gray-800">모름</span>
              </label>
            </div>
          </fieldset>

          <!-- 타임존(공통) -->
          <div>
            <label for="timezone" class="block text-sm font-medium text-gray-800">시간대</label>
            <select id="timezone" class="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/30">
              <option value="Asia/Seoul" selected>Asia/Seoul (KST)</option>
              <option value="UTC">UTC</option>
              <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
              <option value="America/Los_Angeles">America/Los_Angeles (PT)</option>
            </select>
          </div>

          <button id="saju-btn" type="submit"
                  class="w-full rounded-full bg-black text-white font-semibold py-3 disabled:opacity-50 disabled:cursor-not-allowed">
            나의 사주는
          </button>
        </form>

        <!-- 결과 영역 -->
        <div id="result" class="mt-5 hidden">
          <div id="loader" class="text-center text-sm text-gray-700">혜숙이가 풀이 중입니다. 잠시만요…</div>
          <article id="answer" class="prose prose-sm max-w-none hidden bg-[#fff6cc] border border-yellow-300 rounded-xl p-4 leading-relaxed"></article>

          <!-- 공유 버튼 -->
          <div class="mt-3 flex items-center gap-2 justify-end">
            <button id="btn-share-content"
                    class="px-4 py-2 rounded-full bg-black text-white text-sm font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled>
              내용 공유하기
            </button>
            <button id="btn-share-link"
                    class="px-4 py-2 rounded-full border border-gray-800 text-gray-900 bg-white text-sm font-semibold">
              친구야 너도 봐봐
            </button>
          </div>
        </div>

        <p class="mt-4 text-xs text-gray-700">※ 해석은 참고용입니다. 의료·법률·재정 자문이 아니며, 중요한 결정은 신중히 판단하세요.</p>
      </section>
    </main>
  </div>

  <!-- Overlay & Drawer -->
  <div id="drawer-overlay" class="fixed inset-0 bg-black/30 hidden z-40"></div>
  <aside id="drawer" class="fixed right-0 top-0 h-full w-1/2 max-w-md bg-white shadow-xl translate-x-full transition-transform duration-300 z-50">
    <div class="flex items-center justify-between p-4 border-b">
      <h2 class="font-bold text-gray-800">메뉴</h2>
      <button id="drawer-close" class="p-2 rounded-md hover:bg-gray-100" aria-label="메뉴 닫기">
        <svg class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <nav class="p-4 space-y-2">
      <a href="https://hyesugi.com" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">HOME</a>
      <a href="https://hyesugi.com/luck" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">위로와 행운</a>
      <a href="https://hyesugi.com/fate" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 사주는</a>
      <a href="https://hyesugi.com/board" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">익명 게시판</a>
      <a href="https://hyesugi.com/expert" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">전문가 상담</a>
      <a href="https://hyesugi.com/solo" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">솔로는 여기</a>
      <a href="https://hyesugi.com/money" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">돈되는 정보</a>
      <a href="https://hyesugi.com/game" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">신나는 게임</a>
      <a href="https://hyesugi.com/info" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">이용 안내</a>
      <a href="#" id="share-btn" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">공유하기</a>
    </nav>
  </aside>

  <!-- 스크립트 -->
  <script>
    // === Drawer Toggle ===
    const menuBtn = document.getElementById('menu-btn');
    const drawer = document.getElementById('drawer');
    const drawerOverlay = document.getElementById('drawer-overlay');
    const drawerClose = document.getElementById('drawer-close');

    function openDrawer() {
      drawer.classList.remove('translate-x-full');
      drawerOverlay.classList.remove('hidden');
    }
    function closeDrawer() {
      drawer.classList.add('translate-x-full');
      drawerOverlay.classList.add('hidden');
    }

    menuBtn.addEventListener('click', openDrawer);
    drawerOverlay.addEventListener('click', closeDrawer);
    drawerClose.addEventListener('click', closeDrawer);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

    // === Header: 공유하기 ===
    const shareBtn = document.getElementById('share-btn');
    if (shareBtn) {
      shareBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        const shareData = { title: '혜숙이의 상담소', text: '다정한 AI 상담가 혜숙이와 대화해 보세요.', url: 'https://hyesugi.com' };
        try {
          if (navigator.share) {
            await navigator.share(shareData);
          } else {
            await navigator.clipboard.writeText(shareData.url);
            alert('링크가 클립보드에 복사되었습니다: ' + shareData.url);
          }
        } catch (err) {
          console.error(err);
          alert('공유에 실패했어요. 잠시 후 다시 시도해 주세요.');
        }
      });
    }

    // === 사주/궁합 폼 로직 ===
    const API_ENDPOINT = "/api/chat";

    // 라디오 모드
    const modeRadios = document.querySelectorAll('input[name="mode"]');
    const partnerFields = document.getElementById('partner-fields');
    const submitBtn = document.getElementById('saju-btn');

    function updateModeUI() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const isMatch = mode === 'match';
      partnerFields.classList.toggle('hidden', !isMatch);
      submitBtn.textContent = isMatch ? '우리의 궁합은' : '나의 사주는';
    }
    modeRadios.forEach(r => r.addEventListener('change', updateModeUI));
    updateModeUI(); // 초기화

    // 입력 요소
    const form = document.getElementById('saju-form');
    const birthTime = document.getElementById('birthTime');
    const unknownTime = document.getElementById('unknownTime');
    const birthTime2 = document.getElementById('birthTime2');
    const unknownTime2 = document.getElementById('unknownTime2');

    const resultBox = document.getElementById('result');
    const loader = document.getElementById('loader');
    const answer = document.getElementById('answer');

    const shareContentBtn = document.getElementById('btn-share-content');
    const shareLinkBtn = document.getElementById('btn-share-link');

    // 시간 모름 처리
    unknownTime.addEventListener('change', () => {
      birthTime.disabled = unknownTime.checked;
      if (unknownTime.checked) birthTime.value = "";
    });
    unknownTime2.addEventListener('change', () => {
      birthTime2.disabled = unknownTime2.checked;
      if (unknownTime2.checked) birthTime2.value = "";
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const mode = document.querySelector('input[name="mode"]:checked').value; // 'saju' | 'match'

      // A(나)
      const dateA = document.getElementById('birthDate').value;
      const timeA = unknownTime.checked || !birthTime.value ? "모름" : birthTime.value;

      // B(상대) — 궁합일 때만 필요
      const dateB = document.getElementById('birthDate2').value;
      const timeB = (unknownTime2.checked || !birthTime2.value) ? "모름" : birthTime2.value;

      const tz = document.getElementById('timezone').value;

      if (!dateA) {
        alert("내 생년월일을 입력해 주세요.");
        return;
      }
      if (mode === 'match' && !dateB) {
        alert("상대의 생년월일을 입력해 주세요.");
        return;
      }

      // UX: 로딩
      resultBox.classList.remove('hidden');
      answer.classList.add('hidden');
      loader.classList.remove('hidden');
      submitBtn.disabled = true;
      if (shareContentBtn) shareContentBtn.disabled = true;

      const baseSystem = `
너는 '혜숙이'라는 사주 전문가야.
- 한국어만 사용해.
- 전문용어 뒤엔 쉬운 풀이를 덧붙여.
- 과도한 단정보다 '경향/가능성' 위주로.
`;

      const userForSaju = `
다음 정보를 기준으로 성향·강점·주의점·올해 흐름을 간단히 풀이해줘.
- 양력 생년월일: ${dateA}
- 출생시간: ${timeA}
- 시간대: ${tz}
주의:
1) 출생시간이 '모름'이면 시간 해석은 일반화해서 말해줘.
2) 점술·의료·법률 확정 조언은 피하고, 실천 팁 위주로.
3) 섣부른 단정 대신 다양한 가능성을 함께 제시.
마무리에 오늘부터 실천할 수 있는 간단한 조언 3가지를 bullet로 제시.`;

      const userForMatch = `
두 사람의 궁합을 아래 정보로 풀이해줘.
A(나)
- 양력 생년월일: ${dateA}
- 출생시간: ${timeA}

B(상대)
- 양력 생년월일: ${dateB}
- 출생시간: ${timeB}

공통
- 시간대: ${tz}

원하는 출력:
1) 기본 성향 비교 & 잘 맞는 지점
2) 보완/시너지 포인트
3) 갈등이 생기기 쉬운 상황과 완화 팁
4) 소통/데이트/일상에서의 실천 조언 5가지 (bullet)
주의: 확정적 예언 금지, 가능성과 경향 위주. 상대를 존중하는 톤.`;

      const payload = {
        model: "deepseek-chat",
        temperature: 0.7,
        messages: [
          { role: "system", content: baseSystem.trim() },
          { role: "user", content: (mode === 'match' ? userForMatch : userForSaju).trim() }
        ]
      };

      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        let text = "";
        if (data?.choices?.[0]?.message?.content) text = data.choices[0].message.content;
        else if (data?.choices?.[0]?.text) text = data.choices[0].text;
        else if (typeof data === "string") text = data;
        else text = "응답 형식을 이해하지 못했어요. 잠시 후 다시 시도해 주세요.";

        loader.classList.add('hidden');
        answer.classList.remove('hidden');
        answer.textContent = text;

        if (shareContentBtn) shareContentBtn.disabled = !text?.trim();

      } catch (err) {
        console.error(err);
        loader.classList.add('hidden');
        answer.classList.remove('hidden');
        answer.textContent = "요청 중 오류가 발생했어요. 잠시 후 다시 시도해 주세요.";
        if (shareContentBtn) shareContentBtn.disabled = true;
      } finally {
        submitBtn.disabled = false;
      }
    });

    // 공유 버튼
    const answerEl = document.getElementById('answer');
    const shareContentBtn2 = document.getElementById('btn-share-content');
    const shareLinkBtn2 = document.getElementById('btn-share-link');

    if (shareContentBtn2) {
      shareContentBtn2.addEventListener('click', async () => {
        const text = (answerEl.textContent || "").trim();
        if (!text) return;
        const watermark = "\n\n— https://hyesugi.com/fate";
        const shareData = { title: "혜숙이의 풀이", text: text + watermark };
        try {
          if (navigator.share) await navigator.share(shareData);
          else {
            await navigator.clipboard.writeText(shareData.text);
            alert("풀이 내용이 복사되었어요. 원하는 곳에 붙여넣기 하세요!");
          }
        } catch (err) {
          console.error(err);
          alert("공유/복사에 실패했어요. 잠시 후 다시 시도해 주세요.");
        }
      });
    }

    if (shareLinkBtn2) {
      shareLinkBtn2.addEventListener('click', async () => {
        const url = "https://hyesugi.com/fate";
        try {
          if (navigator.share) {
            await navigator.share({ title: "혜숙이의 사주", text: "친구야 너도 봐봐", url });
          } else {
            await navigator.clipboard.writeText(url);
            alert("링크가 복사되었어요: " + url);
          }
        } catch (err) {
          console.error(err);
          alert("공유/복사에 실패했어요. 잠시 후 다시 시도해 주세요.");
        }
      });
    }
  </script>

  <!-- Footer: 커피 한잔 -->
  <footer id="site-footer" class="text-center text-sm text-gray-700 py-6">
    <a href="https://hyesugi.com/donation" target="_blank" rel="noopener noreferrer"
       class="text-black font-semibold hover:underline">
       복채는 괜찮구요! 혜숙이에게 커피 한잔 사주기 ☕
    </a>
  </footer>

</body>
</html>
