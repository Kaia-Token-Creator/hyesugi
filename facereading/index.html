<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QR5TWB3RYJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-QR5TWB3RYJ');
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9891583086388017"
       crossorigin="anonymous"></script>

  <!-- 기본 설정 -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>관상 - 혜숙이, 마음의 쉼터</title>
  <meta name="description" content="혜숙이가 풀어주는 AI 관상(나홀로/커플)도 체험해 보세요." />
  <link rel="canonical" href="https://hyesugi.com/" />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#9bbbd4" />

  <!-- Favicon & App Icons -->
  <link rel="icon" href="https://hyesugi.com/favicon.ico" sizes="any" />
  <link rel="apple-touch-icon" href="https://hyesugi.com/apple-touch-icon.png" sizes="180x180" />
  <link rel="manifest" href="https://hyesugi.com/site.webmanifest" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="hyesugi.com" />
  <meta property="og:url" content="https://hyesugi.com/" />
  <meta property="og:title" content="혜숙이의 상담소 — 관상" />
  <meta property="og:description" content="혜숙이가 풀어주는 관상(나홀로/커플)을 즐겨보세요." />
  <meta property="og:image" content="https://hyesugi.com/facereading/og-image.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="혜숙이 관상 화면 미리보기" />

  <!-- Twitter (X) Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="혜숙이의 상담소 — 관상" />
  <meta name="twitter:description" content="다정한 AI 상담가 ‘혜숙이’와 대화해 보세요." />
  <meta name="twitter:image" content="https://hyesugi.com/facereading/og-image.jpg" />

  <link rel="preload" as="image" href="https://hyesugi.com/preview.jpg" imagesrcset="https://hyesugi.com/facereading/og-image.jpg" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 관상 카드용 약간의 보조 스타일 -->
  <style>
    .outline-card{border:1px solid rgba(0,0,0,.08)}
    .prose-like{white-space:pre-wrap}
    .radio input{accent-color:#111}
  </style>
</head>
<body class="bg-white font-sans">
  <div id="app" class="flex flex-col min-h-screen max-w-3xl mx-auto bg-[#9bbbd4]">

    <!-- Header + 햄버거 메뉴 버튼 -->
    <header class="bg-white/30 backdrop-blur-sm text-center py-4 shadow-md relative">
      <h1 class="text-xl font-bold text-gray-800 flex items-center justify-center gap-2">
        <a href="https://hyesugi.com" class="flex items-center justify-center gap-2" aria-label="hyesugi.com으로 이동">
          <img src="https://hyesugi.com/hyesugi.jpg" alt="혜숙이" class="w-14 h-14 rounded-full object-cover">
          당신의 상담친구 혜숙이
        </a>
      </h1>
      <p class="text-sm text-gray-700">우측 메뉴를 눌러보세요</p>

      <!-- 햄버거 버튼 -->
      <button id="menu-btn" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-white/60 focus:outline-none focus:ring-2 focus:ring-black/40" aria-label="메뉴 열기">
        <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"/>
        </svg>
      </button>
    </header>

    <!-- 본문: 여기 안에 관상 UI 통합 -->
    <main id="content" class="flex-1 p-4">
      <!-- 관상 헤더 -->
      <div class="flex items-center gap-3 mb-4">
        <h2 class="text-lg font-bold text-gray-900">소름돋는 AI 관상</h2>
              </div>

      <!-- 관상 카드 -->
      <section class="bg-white rounded-2xl shadow-md p-4 outline-card">
        <!-- 모드 선택 -->
        <div class="mb-3 text-sm text-gray-800">
          <label class="radio mr-4"><input type="radio" name="mode" value="single" checked class="mr-1"> 나홀로 관상</label>
          <label class="radio"><input type="radio" name="mode" value="couple" class="mr-1"> 커플 관상</label>
        </div>

        <!-- 업로드 영역 -->
        <div id="uploadArea" class="grid gap-3 mb-2"></div>
        <p class="text-xs text-gray-600">
          사람이 아니거나 전면 얼굴 인식이 불명확하면 결과가 정확하지 않을 수 있어요. 사진은 서버에 저장되지 않습니다.
        </p>

        <!-- 실행 버튼 -->
        <div class="mt-3">
          <button id="runBtn"
                  class="w-full md:w-auto px-4 py-2 rounded-xl font-bold text-white bg-gray-900 disabled:opacity-50 disabled:cursor-not-allowed">
            관상 봐줘 혜숙아
          </button>
        </div>

        <!-- 결과 -->
        <div class="mt-4">
          <div class="flex items-center justify-between text-sm text-gray-700">
            <strong>결과 (복채는 그저 공유하기일세..)</strong>
            <span id="status" class="opacity-80">대기 중</span>
          </div>
          <div id="output" class="prose-like mt-2 p-3 rounded-xl border border-gray-200 bg-gray-50 text-gray-900">
            여기에 결과가 표시됩니다.
          </div>
        </div>

        <!-- 복사/공유 버튼 -->
        <div class="mt-3 flex flex-wrap gap-2">
          <button id="copyBtn"
                  class="px-3 py-2 rounded-xl bg-white text-gray-900 font-semibold outline-card disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>결과 복사</button>
          <button id="shareBtn"
                  class="px-3 py-2 rounded-xl bg-white text-gray-900 font-semibold outline-card disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled>결과 공유</button>
          <button id="siteShareBtn"
                  class="px-3 py-2 rounded-xl bg-white text-gray-900 font-semibold outline-card">사이트 공유</button>
        </div>

        <!-- 고지 -->
        <p class="mt-3 text-xs text-gray-600">
          <strong>고지:</strong> 오락/엔터테인먼트 목적이며, 의사결정에 사용하지 마세요. 민감한 속성 추정 금지(나이·성별·인종·건강·정치·종교 등).
        </p>
      </section>
    </main>
  </div>

  <!-- Overlay & Drawer -->
  <div id="drawer-overlay" class="fixed inset-0 bg-black/30 hidden z-40"></div>
  <aside id="drawer" class="fixed right-0 top-0 h-full w-4/5 sm:w-1/2 max-w-md bg-white shadow-xl translate-x-full transition-transform duration-300 z-50">
    <div class="flex items-center justify-between p-4 border-b">
      <h2 class="font-bold text-gray-800">메뉴</h2>
      <button id="drawer-close" class="p-2 rounded-md hover:bg-gray-100" aria-label="메뉴 닫기">
        <svg class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <nav class="p-4 space-y-2">
      <a href="https://hyesugi.com" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">HOME</a>
      <a href="https://hyesugi.com/luck" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">위로와 행운</a>
      <a href="https://hyesugi.com/fate" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">사주와 궁합</a>
      <a href="https://hyesugi.com/facereading" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 관상은</a>
      <a href="https://hyesugi.com/handreading" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 손금은</a>
      <a href="https://hyesugi.com/board" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">익명 게시판</a>
      <a href="https://hyesugi.com/expert" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">전문가 상담</a>
      <a href="https://hyesugi.com/solo" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">솔로는 여기</a>
      <a href="https://hyesugi.com/money" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">돈되는 정보</a>
      <a href="https://hyesugi.com/game" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">신나는 게임</a>
      <a href="https://hyesugi.com/info" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">이용 안내</a>
      <a href="#" id="share-btn" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">공유하기</a>
    </nav>
  </aside>

  <!-- 공통 스크립트: 드로어 + 공유 -->
  <script>
    // === Drawer Toggle ===
    const menuBtn = document.getElementById('menu-btn');
    const drawer = document.getElementById('drawer');
    const drawerOverlay = document.getElementById('drawer-overlay');
    const drawerClose = document.getElementById('drawer-close');

    function openDrawer() {
      drawer.classList.remove('translate-x-full');
      drawerOverlay.classList.remove('hidden');
    }
    function closeDrawer() {
      drawer.classList.add('translate-x-full');
      drawerOverlay.classList.add('hidden');
    }

    menuBtn.addEventListener('click', openDrawer);
    drawerOverlay.addEventListener('click', closeDrawer);
    drawerClose.addEventListener('click', closeDrawer);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

    // === Site Share Button in Drawer ===
    const shareBtnGlobal = document.getElementById('share-btn');
    if (shareBtnGlobal) {
      shareBtnGlobal.addEventListener('click', async (e) => {
        e.preventDefault();
        const shareData = {
          title: '혜숙이의 상담소',
          text: '다정한 AI 상담가 혜숙이와 대화해 보세요.',
          url: 'https://hyesugi.com'
        };
        try {
          if (navigator.share) {
            await navigator.share(shareData);
          } else {
            await navigator.clipboard.writeText(shareData.url);
            alert('링크가 클립보드에 복사되었습니다: ' + shareData.url);
          }
        } catch (err) {
          console.error(err);
          alert('공유에 실패했어요. 잠시 후 다시 시도해 주세요.');
        }
      });
    }
  </script>

  <!-- 관상 기능 스크립트 -->
  <script>
    // ===== 설정 =====
    const API_URL = '/api/face-read'; // CF Pages Functions: /functions/api/face-read.ts
    const modeRadios = document.querySelectorAll('input[name="mode"]');
    const uploadArea = document.getElementById('uploadArea');
    const runBtn = document.getElementById('runBtn');
    const outputEl = document.getElementById('output');
    const statusEl = document.getElementById('status');
    const copyBtn = document.getElementById('copyBtn');
    const shareBtn = document.getElementById('shareBtn');
    const siteShareBtn = document.getElementById('siteShareBtn');

    // ===== 숨김 프롬프트(화면에 노출 X) =====
    const PROMPT_SINGLE = `
당신은 ‘엔터테인먼트용 관상 전문가, 혜숙이'입니다. 조선시대 사극 말투를 사용하세요.
기본 톤은 시크하고, 중간중간 무섭게, 가끔은 호들갑스럽게 표현하세요.
입력은 한 명의 전면 얼굴 사진 1장입니다. 총 1800자까지 작성하세요.

[규칙]
- 민감 정보(나이·성별·인종·건강·정치·종교 등) 추정 금지
- 외모 비하 금지, 존중+긍정
- 예언/단정 금지, 오락 목적 강조
- 얼굴 인식 불명확 시 “얼굴 인식이 어려워 분석 불가” 한 줄

[출력 형식 — 한국어 마크다운]
# 관상 리포트
- 한줄 총평: (시크+무섭+호들갑 믹스)
## 특징 요약
- 이마:
- 눈:
- 코:
- 입/턱:
- 비율/대칭:
## 성향 & 강점 (3)
- 
- 
- 
## 주의할 점 (3)
- 
- 
- 
## 오늘의 관상 멘트(1)
- 
---
**고지:** 오락 목적, 의사결정에 사용하지 마세요.
`.trim();

    const PROMPT_COUPLE = `
당신은 ‘엔터테인먼트용 커플 관상 전문가, 혜숙이’입니다. 조선시대 사극 말투를 사용하세요.
기본 톤은 시크, 중간중간 무섭게, 가끔은 호들갑스럽게 표현하세요.
입력은 전면 얼굴 사진 2장(각각 1명)입니다. 총 1800자까지 작성하세요.

[규칙]
- 민감 정보(나이·성별·인종·건강·정치·종교 등) 추정 금지
- 외모 비하 금지, 존중+긍정
- 예언/단정 금지, 오락 목적 강조
- 얼굴 인식 불명확 시 “얼굴 인식이 어려워 분석 불가” 한 줄

[출력 형식 — 한국어 마크다운]
# 커플 궁합 리포트
- 한줄 총평: (시크+무섭+호들갑 믹스)
## 개인 요약
- A 특징 요약:
- B 특징 요약:
## 궁합 시너지 (3)
- 
- 
- 
## 잠재 충돌 포인트 (3)
- 
- 
- 
## 커뮤니케이션 팁 (3)
- 
- 
- 
## 오늘의 데이트 멘트(1)
- 
---
**고지:** 오락/엔터테인먼트 목적.
`.trim();

    let currentMode = 'single'; // 기본: 나홀로 관상

    function renderUploadArea(mode) {
      if (mode === 'single') {
        uploadArea.innerHTML = `
          <input id="file1" type="file" accept="image/*" class="block w-full text-sm file:mr-3 file:py-2 file:px-3 file:rounded-lg file:border file:bg-white file:text-gray-900 file:font-semibold file:border-gray-200">
          <div class="text-xs text-gray-600">
            사진을 한 장만, 한 명의 전면 얼굴이 명확하게 나오도록 올려주세요.<br>
            사람이 아니거나 인식이 불명확한 경우 제대로 된 결과가 나오지 않습니다.<br>
            사진은 서버에 저장되지 않으니 안심하고 사용하세요
          </div>`;
      } else {
        uploadArea.innerHTML = `
          <div>
            <div class="text-xs text-gray-600 mb-1">첫 번째 사진 (A)</div>
            <input id="file1" type="file" accept="image/*" class="block w-full text-sm file:mr-3 file:py-2 file:px-3 file:rounded-lg file:border file:bg-white file:text-gray-900 file:font-semibold file:border-gray-200">
          </div>
          <div>
            <div class="text-xs text-gray-600 mb-1">두 번째 사진 (B)</div>
            <input id="file2" type="file" accept="image/*" class="block w-full text-sm file:mr-3 file:py-2 file:px-3 file:rounded-lg file:border file:bg-white file:text-gray-900 file:font-semibold file:border-gray-200">
          </div>
          <div class="text-xs text-gray-600">
            사진은 총 2장, 각 사진에는 한 명의 전면 얼굴이 명확하게 나오도록 올려주세요.<br>
            사람이 아니거나 인식이 불명확한 경우 제대로 된 결과가 나오지 않습니다.<br>
            사진은 서버에 저장되지 않으니 안심하고 사용하세요
          </div>`;
      }
      attachFileListeners();
      checkReady();
    }

    modeRadios.forEach(r => {
      r.addEventListener('change', () => {
        if (r.checked) {
          currentMode = r.value;
          renderUploadArea(currentMode);
          outputEl.textContent = '여기에 결과가 표시됩니다.';
          statusEl.textContent = '대기 중';
        }
      });
    });

    function checkReady() {
      const f1 = document.getElementById('file1')?.files?.[0] || null;
      const f2 = document.getElementById('file2')?.files?.[0] || null;
      if (currentMode === 'single') {
        runBtn.disabled = !f1;
      } else {
        runBtn.disabled = !(f1 && f2);
      }
      copyBtn.disabled = true;
      shareBtn.disabled = true;
    }

    function attachFileListeners() {
      const f1 = document.getElementById('file1');
      const f2 = document.getElementById('file2');
      if (f1) {
        f1.addEventListener('change', checkReady);
        f1.addEventListener('input', checkReady);
      }
      if (f2) {
        f2.addEventListener('change', checkReady);
        f2.addEventListener('input', checkReady);
      }
    }

    // 초기 렌더
    renderUploadArea(currentMode);

    function buildResultText() {
      return (outputEl.textContent || '').trim();
    }
    function withWatermark(text) {
      const link = 'https://hyesugi.com/facereading';
      if (!text) return '';
      return `${text}\n\n— 더 보기: ${link}`;
    }

    copyBtn.addEventListener('click', async () => {
      const txt = withWatermark(buildResultText());
      if (!txt) return alert('복사할 내용이 없습니다.');
      try {
        await navigator.clipboard.writeText(txt);
        alert('결과가 링크와 함께 복사되었습니다.');
      } catch (e) {
        console.error(e);
        alert('복사 실패');
      }
    });

    shareBtn.addEventListener('click', async () => {
      const txt = withWatermark(buildResultText());
      if (!txt) return alert('공유할 내용이 없습니다.');
      try {
        if (navigator.share) {
          await navigator.share({
            title: document.title || '관상 리포트',
            text: txt,
            url: 'https://hyesugi.com/facereading'
          });
        } else {
          await navigator.clipboard.writeText(txt);
          alert('이 브라우저는 공유 미지원 → 클립보드에 복사됨');
        }
      } catch (e) {
        console.error(e);
        alert('공유 실패');
      }
    });

    siteShareBtn.addEventListener('click', async () => {
      const url = 'https://hyesugi.com/facereading';
      try {
        if (navigator.share) {
          await navigator.share({
            title: document.title || '소름돋는 AI 관상가 양반',
            url
          });
        } else {
          await navigator.clipboard.writeText(url);
          alert('이 브라우저는 공유 미지원 → 사이트 주소가 클립보드에 복사되었습니다.');
        }
      } catch (e) {
        console.error(e);
        alert('공유 실패');
      }
    });

    // 실행: 프롬프트는 화면에 노출되지 않고 서버로만 전송
    runBtn.addEventListener('click', async () => {
      const f1 = document.getElementById('file1')?.files?.[0] || null;
      const f2 = document.getElementById('file2')?.files?.[0] || null;
      if (currentMode === 'single' && !f1) return;
      if (currentMode === 'couple' && !(f1 && f2)) return;

      statusEl.textContent = '분석 중...';
      outputEl.textContent = '분석 중입니다...';

      copyBtn.disabled = true;
      shareBtn.disabled = true;

      try {
        const fd = new FormData();
        fd.append('mode', currentMode);
        fd.append('prompt', currentMode === 'single' ? PROMPT_SINGLE : PROMPT_COUPLE); // 🔒 서버로만 전달
        fd.append('image1', f1);
        if (currentMode === 'couple') fd.append('image2', f2);

        const res = await fetch(API_URL, { method: 'POST', body: fd });
        if (!res.ok) {
          const text = await res.text().catch(()=> '');
          throw new Error(`HTTP ${res.status} ${res.statusText} ${text?'- '+text:''}`);
        }
        const data = await res.json();
        const content = (data && (data.content || data.result || data.text)) || '';
        outputEl.textContent = content || '내용이 비어 있습니다.';
        statusEl.textContent = '완료';

        const hasContent = !!(content && content.trim());
        copyBtn.disabled = !hasContent;
        shareBtn.disabled = !hasContent;
      } catch (err) {
        outputEl.textContent = '에러가 발생했습니다: ' + err.message;
        statusEl.textContent = '실패';
      }
    });
  </script>

  <!-- Footer -->
  <footer id="site-footer" class="text-center text-sm text-gray-700 py-6 space-y-2">
    <div>
      <a href="https://hyesugi.com/donation" target="_blank" rel="noopener noreferrer"
         class="text-black font-semibold hover:underline">
         혜숙이에게 커피 한잔 사주기 ☕
      </a>
    </div>
    <hr class="border-t border-gray-300 opacity-50 w-2/3 mx-auto">
    <div id="ad-slot"></div>
  </footer>

  <script>
    // ⚠️ 원본 코드에 누락된 쉼표를 보완함
    const ads = [
      { text: "인터넷 바꾸면 47만원 지급해드려요!", url: "https://iryan.kr/t73750ushf" },
      { text: "1시간 투자, 월평균 148만원 버는 고효율 부업", url: "https://iryan.kr/t738hkv2k0" },
      { text: "넷플릭스 글로벌 컨텐츠 잠금해제하는 방법", url: "https://hyesugi.com/vpn" },
      { text: "인간으로 살아남기", url: "https://hyesugi.com/world" },
      { text: "노트북, 데스크탑, 아이패드, 태블릿 초특가 구매", url: "https://hyesugi.com/refur" }
    ];
    const pick = ads[Math.floor(Math.random() * ads.length)];
    const slot = document.getElementById("ad-slot");
    if (slot) {
      const a = document.createElement("a");
      a.href = pick.url;
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.className = "text-blue-600 font-bold underline";
      a.textContent = pick.text;
      slot.replaceChildren(a);
    }
  </script>
</body>
</html>

