<!DOCTYPE html> 
<html lang="ko"> 
<head> 
  <!-- Google tag (gtag.js) --> 
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QR5TWB3RYJ"></script> 
  <script>
    window.dataLayer = window.dataLayer || []; 
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-QR5TWB3RYJ'); 
  </script>

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9891583086388017" crossorigin="anonymous"></script> 

  <!-- 기본 설정 --> 
  <meta charset="utf-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" /> 
  <title>혜숙이, 마음의 쉼터 — 공포게임</title> 
  <meta name="description" content="상담가이자 다정한 친구 ‘혜숙이’. A/B 선택형 10챕터 공포게임을 즐겨보세요." /> 
  <link rel="canonical" href="https://hyesugi.com/" /> 
  <meta name="robots" content="index,follow" /> 
  <meta name="theme-color" content="#000000" /> 

  <!-- Favicon & App Icons --> 
  <link rel="icon" href="https://hyesugi.com/favicon.ico" sizes="any" /> 
  <link rel="apple-touch-icon" href="https://hyesugi.com/apple-touch-icon.png" sizes="180x180" /> 
  <link rel="manifest" href="https://hyesugi.com/site.webmanifest" /> 

  <!-- Open Graph --> 
  <meta property="og:type" content="website" /> 
  <meta property="og:site_name" content="hyesugi.com" /> 
  <meta property="og:url" content="https://hyesugi.com/horror" /> 
  <meta property="og:title" content="공포게임 — 혜숙이의 이야기" /> 
  <meta property="og:description" content="A/B 선택으로 이어지는 10챕터 공포 이야기" /> 
  <meta property="og:image" content="https://hyesugi.com/og-image.jpg" /> 
  <meta property="og:image:width" content="1200" /> 
  <meta property="og:image:height" content="630" /> 
  <meta property="og:image:alt" content="혜숙이 공포게임 미리보기" /> 

  <!-- Twitter (X) Card --> 
  <meta name="twitter:card" content="summary_large_image" /> 
  <meta name="twitter:title" content="공포게임 — 혜숙이의 이야기" /> 
  <meta name="twitter:description" content="A/B 선택으로 이어지는 10챕터 공포 이야기" /> 
  <meta name="twitter:image" content="https://hyesugi.com/og-image.jpg" /> 

  <link rel="preload" as="image" href="https://hyesugi.com/preview.jpg" imagesrcset="https://hyesugi.com/preview.jpg" /> 

  <!-- Tailwind --> 
  <script src="https://cdn.tailwindcss.com"></script> 

  <!-- 🔴 테마 오버라이드: 검정 배경 + 빨간 궁서체 -->
  <style>
    :root{
      --bg:#000000;
      --panel:#0b0b0b;
      --ink:#e60000;
      --ink-dim:#d20000;
      --btn-bg:#111111;
      --btn-bg-hover:#1c1c1c;
      --ring:rgba(230,0,0,0.5);
    }
    html, body { background: var(--bg); }
    body {
      color: var(--ink);
      font-family: "Gungsuh","GungSeo","Batang","Gowun Batang","Nanum Myeongjo",serif;
      letter-spacing: .2px;
    }
    ::selection { background:#700; color:#fff; }
  </style>
</head> 

<body class="bg-black font-sans"> 
  <!-- ✅ 기존 컨테이너: 배경색만 검정으로 변경 -->
  <div id="app" class="flex flex-col min-h-screen max-w-3xl mx-auto bg-black"> 

    <!-- ✅ 기존 헤더/메뉴 유지 -->
    <header class="bg-black text-center py-4 shadow-md relative"> 
      <h1 class="text-xl font-bold text-red-600 flex items-center justify-center gap-2" style="font-family:'Gungsuh','GungSeo','Batang','Gowun Batang',serif;">
        <a href="https://hyesugi.com" class="flex items-center justify-center gap-2" aria-label="hyesugi.com으로 이동"> 
          <img src="https://hyesugi.com/hyesugi.jpg" alt="혜숙이" class="w-14 h-14 rounded-full object-cover border border-red-900"> 
          당신의 상담친구 혜숙이 
        </a> 
      </h1> 
      <p class="text-sm" style="color:var(--ink-dim)"><b></b>공포 게임</p>

      <!-- 햄버거 버튼 --> 
      <button id="menu-btn" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-red-700/40" aria-label="메뉴 열기"> 
        <svg class="w-6 h-6" style="color:var(--ink)" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"/> 
        </svg> 
      </button> 
    </header> 

    <!-- ✅ 본문: 여기만 공포게임으로 채움 -->
    <main id="content" class="flex-1 p-4"> 
      <section class="space-y-4">
        <!-- 메시지 박스 -->
        <div id="story-box" class="rounded-2xl p-5 shadow-lg"
             style="background:var(--panel); border:1px solid #161616; line-height:1.85; font-size:1.05rem;">
          <div id="chapter-indicator" class="text-xs uppercase tracking-widest mb-2" style="color:#a40000;">
            준비 중…
          </div>
          <div id="story-text" class="whitespace-pre-wrap"></div>
        </div>

        <!-- A/B 버튼 -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <button id="btn-A" class="w-full rounded-xl px-5 py-4 text-lg border transition focus:outline-none focus:ring"
                  style="background:var(--btn-bg); border-color:#2a2a2a; color:var(--ink); font-family:'Gungsuh','GungSeo','Batang','Gowun Batang',serif;">
            A
          </button>
          <button id="btn-B" class="w-full rounded-xl px-5 py-4 text-lg border transition focus:outline-none focus:ring"
                  style="background:var(--btn-bg); border-color:#2a2a2a; color:var(--ink); font-family:'Gungsuh','GungSeo','Batang','Gowun Batang',serif;">
            B
          </button>
        </div>

        <!-- 리스타트/공유 -->
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
          <button id="btn-restart" class="flex-1 rounded-xl px-5 py-3 text-base border transition"
                  style="background:var(--btn-bg); border-color:#2a2a2a; color:var(--ink-dim); font-family:'Gungsuh','GungSeo','Batang','Gowun Batang',serif;">
            다른 스토리 진행
          </button>
          <button id="btn-share" class="rounded-xl px-5 py-3 text-base border transition"
                  style="background:var(--btn-bg); border-color:#2a2a2a; color:var(--ink); font-family:'Gungsuh','GungSeo','Batang','Gowun Batang',serif;">
            공포게임 공유하기
          </button>
        </div>

        <p class="text-xs opacity-70" style="color:#7a0000;">* 10장에 도달하면 A/B 버튼이 비활성화됩니다. “다른 스토리 진행”으로 새로운 이야기를 시작하세요.</p>
      </section>
    </main> 

    <!-- ✅ 기존 드로어/오버레이 유지 -->
    <div id="drawer-overlay" class="fixed inset-0 bg-black/30 hidden z-40"></div> 
    <aside id="drawer" class="fixed right-0 top-0 h-full w-1/2 max-w-md bg-white shadow-xl translate-x-full transition-transform duration-300 z-50"> 
      <div class="flex items-center justify-between p-4 border-b"> 
        <h2 class="font-bold text-gray-800">메뉴</h2> 
        <button id="drawer-close" class="p-2 rounded-md hover:bg-gray-100" aria-label="메뉴 닫기"> 
          <svg class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="none" stroke="currentColor"> 
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/> 
          </svg> 
        </button> 
      </div> 
      <nav class="p-4 space-y-2"> 
        <a href="https://hyesugi.com" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">HOME</a> 
        <a href="https://hyesugi.com/luck" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">위로와 행운</a> 
        <a href="https://hyesugi.com/fate" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">사주와 궁합</a> 
        <a href="https://hyesugi.com/facereading" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 관상은</a> 
        <a href="https://hyesugi.com/handreading" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 손금은</a> 
        <a href="https://hyesugi.com/board" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">익명 게시판</a> 
        <a href="https://hyesugi.com/expert" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">전문가 상담</a> 
        <a href="https://hyesugi.com/solo" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">솔로는 여기</a> 
        <a href="https://hyesugi.com/money" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">돈되는 정보</a> 
        <a href="https://hyesugi.com/game" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">신나는 게임</a> 
        <a href="https://hyesugi.com/tube" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">혜숙이 튜브</a> 
        <a href="https://hyesugi.com/info" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">이용 안내</a> 
        <a href="#" id="share-btn" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">공유하기</a> 
      </nav> 
    </aside> 

    <!-- ✅ 기존 푸터/광고 영역 유지 -->
    <footer id="site-footer" class="text-center text-sm py-6 space-y-2" style="color:var(--ink-dim)"> 
      <div>
        <a href="https://hyesugi.com/donation" target="_blank" rel="noopener noreferrer" class="font-semibold hover:underline" style="color:var(--ink);">
          혜숙이에게 커피 한잔 사주기 ☕
        </a>
      </div>
      <hr class="border-t border-gray-700 opacity-50 w-2/3 mx-auto">
      <div id="ad-slot"></div> 
    </footer> 
  </div> 

  <!-- ✅ 기존 공통 스크립트(드로어+공유) 유지 -->
  <script> 
    const menuBtn = document.getElementById('menu-btn'); 
    const drawer = document.getElementById('drawer'); 
    const drawerOverlay = document.getElementById('drawer-overlay'); 
    const drawerClose = document.getElementById('drawer-close'); 

    function openDrawer() { drawer.classList.remove('translate-x-full'); drawerOverlay.classList.remove('hidden'); }
    function closeDrawer() { drawer.classList.add('translate-x-full'); drawerOverlay.classList.add('hidden'); }

    menuBtn.addEventListener('click', openDrawer); 
    drawerOverlay.addEventListener('click', closeDrawer); 
    drawerClose.addEventListener('click', closeDrawer); 
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

    const shareBtn = document.getElementById('share-btn'); 
    if (shareBtn) {
      shareBtn.addEventListener('click', async (e) => { 
        e.preventDefault(); 
        const shareData = { title: '혜숙이의 상담소', text: '다정한 AI 상담가 혜숙이와 대화해 보세요.', url: location.href };
        try {
          if (navigator.share) await navigator.share(shareData);
          else { await navigator.clipboard.writeText(shareData.url); alert('링크 복사됨: ' + shareData.url); }
        } catch (err) { console.error(err); alert('공유에 실패했어요.'); }
      });
    }
  </script>

  <!-- ✅ 공포게임 스크립트 (API 연동) -->
  <script>
    const API_ENDPOINT = "/api/horror";

    const storyText = document.getElementById("story-text");
    const chapterIndicator = document.getElementById("chapter-indicator");
    const btnA = document.getElementById("btn-A");
    const btnB = document.getElementById("btn-B");
    const btnRestart = document.getElementById("btn-restart");

    function uuid() {
      return crypto.getRandomValues(new Uint8Array(16)).reduce((a,b)=>a+b.toString(16).padStart(2,"0"),"");
    }
    function loadSession() {
      let sessionId = localStorage.getItem("horrorSessionId");
      if (!sessionId) { sessionId = uuid(); localStorage.setItem("horrorSessionId", sessionId); }
      let log = [];
      try { log = JSON.parse(localStorage.getItem("horrorStoryLog") || "[]"); } catch {}
      return { sessionId, log };
    }
    function saveLog(log) { localStorage.setItem("horrorStoryLog", JSON.stringify(log)); }
    function resetAll() { localStorage.removeItem("horrorStoryLog"); localStorage.setItem("horrorSessionId", uuid()); }

    function setChoiceEnabled(ok) {
      [btnA, btnB].forEach(b => { b.disabled = !ok; b.style.opacity = ok ? "1" : "0.5"; b.style.cursor = ok ? "pointer" : "not-allowed"; });
    }

    async function requestChapter({ chapter, choice, reset=false }) {
      const { sessionId, log } = loadSession();
      const payload = { sessionId, chapter, choice, log, reset };
      const r = await fetch(API_ENDPOINT, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(payload) });
      if (!r.ok) throw new Error(await r.text());
      return await r.json();
    }

    function renderChapter(data) {
      const { chapterNumber, text, choices, isFinal } = data;
      chapterIndicator.textContent = `Chapter ${chapterNumber}`;
      storyText.textContent = text;

      if (choices) {
        btnA.textContent = `A. ${choices.A}`;
        btnB.textContent = `B. ${choices.B}`;
        setChoiceEnabled(true);
      } else {
        btnA.textContent = "A";
        btnB.textContent = "B";
        setChoiceEnabled(false);
      }

      const state = loadSession();
      const newLog = [...state.log, { chapter: chapterNumber, text }];
      saveLog(newLog);
    }

    async function boot() {
      setChoiceEnabled(false);
      chapterIndicator.textContent = "로딩 중…잠시만 기..다...려...";
      storyText.textContent = "";

      const state = loadSession();
      const last = state.log[state.log.length - 1];

      try {
        if (last?.chapter > 0) {
          chapterIndicator.textContent = `Chapter ${last.chapter}`;
          storyText.textContent = last.text;
          setChoiceEnabled(true);
        } else {
          const data = await requestChapter({ chapter: 0, reset: true });
          renderChapter(data);
        }
      } catch {
        chapterIndicator.textContent = "오류";
        storyText.textContent = "잠시 후 다시 시도해 주세요.";
      }
    }

    async function onPick(p) {
      try {
        setChoiceEnabled(false);
        const state = loadSession();
        const lastChapter = state.log[state.log.length - 1]?.chapter || 0;
        if (state.log.length > 0) { state.log[state.log.length - 1].choice = p; saveLog(state.log); }
        const next = await requestChapter({ chapter: lastChapter, choice: p });
        renderChapter(next);
        setChoiceEnabled(next.choices && !next.isFinal);
      } catch {
        alert("문제가 발생했어요. 다시 시도해 주세요.");
        setChoiceEnabled(true);
      }
    }

    btnA.addEventListener("click", () => onPick("A"));
    btnB.addEventListener("click", () => onPick("B"));
    btnRestart.addEventListener("click", () => { resetAll(); location.reload(); });

    // 작은 호버 효과
    [btnA, btnB, btnRestart].forEach((el) => {
      el.addEventListener("mouseenter", () => { el.style.background = "var(--btn-bg-hover)"; el.style.boxShadow = "0 0 0 2px var(--ring)"; });
      el.addEventListener("mouseleave", () => { el.style.background = "var(--btn-bg)"; el.style.boxShadow = "none"; });
    });

    boot();
  </script>

  <!-- (선택) 랜덤 광고 스크립트가 있다면 그대로 유지 -->
  <script>
    // 기존 ads 배열/랜더링 로직 그대로 두세요.
    // 예: const ads = [ ... ];
    // document.getElementById("ad-slot") 등에 삽입
  </script>
</body> 
</html>

