<!DOCTYPE html>
<html lang="ko">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QR5TWB3RYJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QR5TWB3RYJ');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9891583086388017"
     crossorigin="anonymous"></script>

<meta name="naver-site-verification" content="fbe7ca9cbb5ebd5494222faf40a1bb1155581dff" />

<!-- 기본 설정 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>혜숙이, 마음의 쉼터</title>
<meta name="description" content="상담가이자 다정한 친구, ‘혜숙이’가 당신의 고민을 들어드립니다." />
<link rel="canonical" href="https://hyesugi.com/" />
<meta name="robots" content="index,follow" />
<meta name="theme-color" content="#9bbbd4" />

<!-- Favicon & App Icons -->
<link rel="icon" href="https://hyesugi.com/favicon.ico" sizes="any" />
<link rel="apple-touch-icon" href="https://hyesugi.com/apple-touch-icon.png" sizes="180x180" />
<link rel="manifest" href="https://hyesugi.com/site.webmanifest" />

<!-- Open Graph (Facebook, Kakao, Slack 등) -->
<meta property="og:type" content="website" />
<meta property="og:site_name" content="hyesugi.com" />
<meta property="og:url" content="https://hyesugi.com/" />
<meta property="og:title" content="혜숙이의 상담소" />
<meta property="og:description" content="‘혜숙이’가 다정하게 고민을 들어드립니다" />
<meta property="og:image" content="https://hyesugi.com/og-image.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content="혜숙이 상담 화면 미리보기" />

<!-- Twitter (X) Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="혜숙이의 상담소" />
<meta name="twitter:description" content="다정한 AI 상담가 ‘혜숙이’와 대화해 보세요." />
<meta name="twitter:image" content="https://hyesugi.com/og-image.jpg" />

<link rel="preload" as="image" href="https://hyesugi.com/preview.jpg" imagesrcset="https://hyesugi.com/preview.jpg" />

<script src="https://cdn.tailwindcss.com"></script>
<style>
    #chat-container::-webkit-scrollbar { width: 8px; }
    #chat-container::-webkit-scrollbar-track { background: #f1f1f1; }
    #chat-container::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    #chat-container::-webkit-scrollbar-thumb:hover { background: #555; }

:root { --anchorH: 80px; --kb: 0px; --kbGap: 0px; } /* kbGap = 키보드 위 여백 */

#app{
  /* 키보드 높이 제거: 앵커 + 세이프영역만 */
  padding-bottom: calc(var(--anchorH) + env(safe-area-inset-bottom));
}
#chat-footer{
  position: sticky;
  /* 키보드가 없으면 anchorH, 있으면 kb + kbGap 을 사용 */
  bottom: calc(max(var(--anchorH), calc(var(--kb) + var(--kbGap))) + env(safe-area-inset-bottom));
  z-index: 30;
}

</style>
</head>
<body class="bg-white font-sans">
<div id="app" class="flex flex-col min-h-[100svh] max-w-3xl mx-auto bg-[#9bbbd4]">

<!-- Header + 햄버거 메뉴 버튼 -->
<header class="bg-white/30 backdrop-blur-sm text-center py-4 shadow-md relative">
  <h1 class="text-xl font-bold text-gray-800 flex items-center justify-center gap-2">
    <a href="https://hyesugi.com" class="flex items-center justify-center gap-2" aria-label="hyesugi.com으로 이동">
      <img src="https://hyesugi.com/hyesugi.jpg" alt="혜숙이" class="w-14 h-14 rounded-full object-cover">
      당신의 상담친구 혜숙이
    </a>
  </h1>
  <p class="text-sm text-gray-600">우측 메뉴를 눌러보세요</p>

  <!-- 햄버거 버튼 -->
  <button id="menu-btn" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-white/60 focus:outline-none focus:ring-2 focus:ring-black/40" aria-label="메뉴 열기">
    <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"/>
    </svg>
  </button>
</header>

<!-- Chat Container -->
<div id="chat-container" class="flex-1 p-4 overflow-y-auto space-y-4">
    <div class="flex justify-start">
        <div class="bg-white rounded-lg p-3 max-w-xs md:max-w-md shadow">
            <p class="text-gray-800">안녕하세요, 혜숙이에요. 어떤 고민이 있으신가요? 당신의 이야기를 들어줄게요. 가정/학업/이성/금전/마음상태 뭐든지 편하게 말씀해주세요.</p>
        </div>
    </div>
</div>

<div id="loading" class="hidden flex items-center justify-start p-4">
    <div class="flex items-center space-x-2">
        <div class="bg-white rounded-lg p-3 shadow flex items-center space-x-2">
            <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: -0.3s;"></div>
            <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: -0.15s;"></div>
            <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="chat-footer" class="p-4 bg-white/30 backdrop-blur-sm">
  <div class="relative flex items-center">
    <input type="text" id="user-input" class="w-full bg-white rounded-full py-2 pl-5 pr-14 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400 shadow-inner" placeholder="메시지를 입력하세요...">
    <button id="send-button" class="absolute right-2 top-1/2 -translate-y-1/2 w-9 h-9 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
    </button>
  </div>
</footer>
</div>

<!-- Overlay & Drawer -->
<div id="drawer-overlay" class="fixed inset-0 bg-black/30 hidden z-40"></div>
<aside id="drawer" class="fixed right-0 top-0 h-full w-1/2 max-w-md bg-white shadow-xl translate-x-full transition-transform duration-300 z-50">
  <div class="flex items-center justify-between p-4 border-b">
    <h2 class="font-bold text-gray-800">메뉴</h2>
    <button id="drawer-close" class="p-2 rounded-md hover:bg-gray-100" aria-label="메뉴 닫기">
      <svg class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>
  <nav class="p-4 space-y-2">
    <a href="luck" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">위로와 행운</a>
    <a href="fate" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">사주와 궁합</a>
    <a href="facereading" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 관상은</a>
    <a href="handreading" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 손금은</a>
    <a href="board" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">익명 게시판</a>
<a href="expert" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">전문가 상담</a>
<a href="solo" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">솔로는 여기</a>
<a href="money" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">돈되는 정보</a>
<a href="game" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">신나는 게임</a>
<a href="info" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">이용 안내</a>
<a href="#" id="share-btn" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">공유하기</a>

  </nav>
</aside>

<script>
const chatContainer = document.getElementById('chat-container');
const userInput = document.getElementById('user-input');
const sendButton = document.getElementById('send-button');
const loadingIndicator = document.getElementById('loading');

// 대화 기록 저장
let conversationHistory = [];

// 시스템 메시지
const systemMessage = {
    role: 'system',
    content: [
    "너는 '혜숙이' — 다정한 한국어 상담 친구야.",
    "목표: 사용자의 감정에 공감하고 위로하며, 부담 없는 실용적 조언을 제공해.",
    "반드시 한국어로 답하고, 친근하지만 친구 같은 말투를 사용해.",
    "사용자의 말투·길이를 '미러링'해서 답변 길이와 표현 수위를 맞춰줘.",
    "첫 문장은 공감/인정(예: '그 마음, 정말 힘들었겠다').",
    "그 다음은 작은 제안 1~2개만, 과한 해결책 나열 금지.",
    "전문적 치료·법률 판단이 필요한 상황은 진단 대신 전문가 상담을 권유해.",
    "자해/타해·위기 신호가 보이면 안전을 최우선으로 하고, 지역 긴급번호·상담기관 도움을 권유해.",
    "모델·토큰·시스템 같은 기술 용어는 언급하지 마. 사람이 대화하듯 자연스럽게.",
    "직접 묻지 않는 이상 스스로 'AI'라고 밝히지 마. (단, 물으면 정직하게 밝히고 따뜻하게 대화 이어가기)",
    "과장·단정·판단 단어는 피하고, 따뜻하고 담백하게.",
    "불필요한 이모지는 자제하되, 정말 위로가 될 때만 적게 사용해.",
    "중국어 한자·특수 기호(** 등)는 사용하지 마."
  ].join("\n")
};

// 메시지 출력
function addMessageToChat(message, sender) {
    const messageWrapper = document.createElement('div');
    messageWrapper.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

    const messageBubble = document.createElement('div');
    messageBubble.className = `rounded-lg p-3 max-w-xs md:max-w-md shadow ${sender === 'user' ? 'bg-[#FFCD50] text-gray-800' : 'bg-white text-gray-800'}`;
    messageBubble.innerText = message;
    
    messageWrapper.appendChild(messageBubble);
    chatContainer.appendChild(messageWrapper);

    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// AI 응답
async function getAIResponse() {
    const userMessage = userInput.value.trim();
    if (userMessage === '') return;

    addMessageToChat(userMessage, 'user');
    conversationHistory.push({ role: 'user', content: userMessage });
    userInput.value = '';
    loadingIndicator.classList.remove('hidden');

    try {
       const response = await fetch('/api/chatGPT', { // ← OpenAI 라우트로 교체
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    model: 'gpt-4o-mini', // ← OpenAI 모델로 교체 (원하면 다른 OpenAI 모델 id로 변경 가능)
    messages: [systemMessage, ...conversationHistory]
  })
});
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error.message || 'API 호출에 실패했습니다.');
        }

        const data = await response.json();
        const aiMessage = data.choices[0].message.content;

        addMessageToChat(aiMessage, 'ai');
        conversationHistory.push({ role: 'assistant', content: aiMessage });

    } catch (error) {
        console.error('Error:', error);
        addMessageToChat('죄송해요, 지금은 답변을 드릴 수 없어요. 잠시 후 다시 시도해주세요.', 'ai');
    } finally {
        loadingIndicator.classList.add('hidden');
    }
}

// 이벤트 리스너
sendButton.addEventListener('click', getAIResponse);
userInput.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
        event.preventDefault();
        getAIResponse();
    }
});

// === Drawer Toggle ===
const menuBtn = document.getElementById('menu-btn');
const drawer = document.getElementById('drawer');
const drawerOverlay = document.getElementById('drawer-overlay');
const drawerClose = document.getElementById('drawer-close');

function openDrawer() {
  drawer.classList.remove('translate-x-full');
  drawerOverlay.classList.remove('hidden');
}
function closeDrawer() {
  drawer.classList.add('translate-x-full');
  drawerOverlay.classList.add('hidden');
}
menuBtn.addEventListener('click', openDrawer);
drawerOverlay.addEventListener('click', closeDrawer);
drawerClose.addEventListener('click', closeDrawer);
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

// === Share Button ===
const shareBtn = document.getElementById('share-btn');
if (shareBtn) {
  shareBtn.addEventListener('click', async (e) => {
    e.preventDefault();
    const shareData = {
      title: '혜숙이의 상담소',
      text: '다정한 AI 상담가 혜숙이와 대화해 보세요.',
      url: 'https://hyesugi.com'
    };
    try {
      if (navigator.share) {
        await navigator.share(shareData);
      } else {
        await navigator.clipboard.writeText(shareData.url);
        alert('링크가 클립보드에 복사되었습니다: ' + shareData.url);
      }
    } catch (err) {
      console.error(err);
      alert('공유에 실패했어요. 잠시 후 다시 시도해 주세요.');
    }
  });
}

</script>

<footer id="site-footer" class="text-center text-sm text-gray-700 py-6 space-y-2">
  <!-- ☕ 고정 첫 줄 -->
  <div>
    <a href="https://hyesugi.com/donation" target="_blank" rel="noopener noreferrer"
       class="text-black font-semibold hover:underline">
       혜숙이에게 커피 한잔 사주기 ☕
    </a>
  </div>

  <!-- 연한 구분선 -->
  <hr class="border-t border-gray-300 opacity-50 w-2/3 mx-auto">

  <!-- 🔀 랜덤 광고 줄 -->
  <div id="ad-slot"></div>
</footer>

<script>
  const ads = [
    { text: "인터넷 바꾸면 47만원 지급해드려요!", url: "https://iryan.kr/t73750ushf" },
    { text: "1시간 투자, 월평균 148만원 버는 고효율 부업", url: "https://iryan.kr/t738hkv2k0" },
    { text: "넷플릭스 글로벌 컨텐츠 잠금해제하는 방법", url: "https://hyesugi.com/vpn" },
    { text: "인간으로 살아남기", url: "https://hyesugi.com/world" }
  ];

  const pick = ads[Math.floor(Math.random() * ads.length)];
  const slot = document.getElementById("ad-slot");
  if (slot) {
    const a = document.createElement("a");
    a.href = pick.url;
    a.target = "_blank";
    a.rel = "noopener noreferrer";
    a.className = "text-blue-600 font-bold underline";
    a.textContent = pick.text;
    slot.replaceChildren(a);
  }
</script>
<script>
/**
 * 모바일 키보드가 올라올 때 #chat-footer가 가려지지 않도록
 * window.visualViewport를 이용해 키보드 높이를 계산하여 CSS 변수(--kb)를 갱신한다.
 */
(function keyboardGuard() {
  const rootStyle = document.documentElement.style;
  const vv = window.visualViewport;

  function setKB(px) {
    const v = Math.max(0, Math.round(px || 0));
    rootStyle.setProperty('--kb', v + 'px');
  }

  function updateKB() {
    if (vv) {
      const overlap = (window.innerHeight - vv.height - vv.offsetTop);
      setKB(overlap);
    } else {
      setKB(0);
    }
  }

  if (vv) {
    vv.addEventListener('resize', updateKB);
    vv.addEventListener('scroll', updateKB);
  }
  window.addEventListener('orientationchange', () => setTimeout(updateKB, 250));
  window.addEventListener('resize', updateKB);

  updateKB();

  const input = document.getElementById('user-input');
  if (input) {
    input.addEventListener('focus', () => {
      setTimeout(() => {
        try {
          input.scrollIntoView({ block: 'nearest', inline: 'nearest', behavior: 'smooth' });
        } catch (_) {}
      }, 150);
    });
  }
})();
</script>
</body>
</html>

