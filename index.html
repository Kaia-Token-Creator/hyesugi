<!DOCTYPE html>
<html lang="ko">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QR5TWB3RYJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QR5TWB3RYJ');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9891583086388017"
     crossorigin="anonymous"></script>

<meta name="naver-site-verification" content="fbe7ca9cbb5ebd5494222faf40a1bb1155581dff" />

<!-- 기본 설정 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>혜숙이, 마음의 쉼터</title>
<meta name="description" content="상담가이자 다정한 친구, ‘혜숙이’가 당신의 고민을 들어드립니다." />
<link rel="canonical" href="https://hyesugi.com/" />
<meta name="robots" content="index,follow" />
<meta name="theme-color" content="#9bbbd4" />

<!-- Favicon & App Icons -->
<link rel="icon" href="https://hyesugi.com/favicon.ico" sizes="any" />
<link rel="apple-touch-icon" href="https://hyesugi.com/apple-touch-icon.png" sizes="180x180" />
<link rel="manifest" href="https://hyesugi.com/site.webmanifest" />

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:site_name" content="hyesugi.com" />
<meta property="og:url" content="https://hyesugi.com/" />
<meta property="og:title" content="혜숙이의 상담소" />
<meta property="og:description" content="‘혜숙이’가 다정하게 고민을 들어드립니다" />
<meta property="og:image" content="https://hyesugi.com/og-image.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content="혜숙이 상담 화면 미리보기" />

<!-- Twitter (X) Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="혜숙이의 상담소" />
<meta name="twitter:description" content="다정한 AI 상담가 ‘혜숙이’와 대화해 보세요." />
<meta name="twitter:image" content="https://hyesugi.com/og-image.jpg" />

<link rel="preload" as="image" href="https://hyesugi.com/preview.jpg" imagesrcset="https://hyesugi.com/preview.jpg" />

<script src="https://cdn.tailwindcss.com"></script>
<style>
    #chat-container::-webkit-scrollbar { width: 8px; }
    #chat-container::-webkit-scrollbar-track { background: #f1f1f1; }
    #chat-container::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    #chat-container::-webkit-scrollbar-thumb:hover { background: #555; }

:root { --anchorH: 80px; --kb: 0px; --kbGap: 0px; }

#app{
  padding-bottom: calc(var(--anchorH) + env(safe-area-inset-bottom));
}
#chat-footer{
  position: sticky;
  bottom: calc(max(var(--anchorH), calc(var(--kb) + var(--kbGap))) + env(safe-area-inset-bottom));
  z-index: 30;
}

.msg-row { display: flex; gap: 8px; }
.msg-row.ai { justify-content: flex-start; }
.msg-row.user { justify-content: flex-end; }

.avatar {
  width: 36px; height: 36px;
  border-radius: 9999px;
  flex: 0 0 36px;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.06) inset;
}
.avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }

.avatar-user {
  background: #fff;
  color: #000;
  font-weight: 700;
  font-size: 14px;
  line-height: 36px;
  text-align: center;
  user-select: none;
}

.bubble {
  border-radius: 0.5rem;
  padding: 0.75rem;
  max-width: 20rem;
  box-shadow: 0 1px 2px rgba(0,0,0,0.08);
}
@media (min-width: 768px){
  .bubble { max-width: 28rem; }
}
.bubble-ai { background: #fff; color: #1f2937; }
.bubble-user { background: #FFCD50; color: #1f2937; }
</style>
</head>
<body class="bg-white font-sans">
<div id="app" class="flex flex-col min-h-[100svh] max-w-3xl mx-auto bg-[#9bbbd4]">

<header class="bg-white/30 backdrop-blur-sm text-center py-4 shadow-md relative">
  <h1 class="text-xl font-bold text-gray-800 flex items-center justify-center gap-2">
    <a href="https://hyesugi.com" class="flex items-center justify-center gap-2" aria-label="hyesugi.com으로 이동">
      <img src="https://hyesugi.com/hyesugi.jpg" alt="혜숙이" class="w-14 h-14 rounded-full object-cover">
      당신의 상담친구 혜숙이
    </a>
  </h1>
  <p class="text-sm text-gray-600">우측 메뉴를 눌러보세요</p>
  <button id="menu-btn" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-white/60 focus:outline-none focus:ring-2 focus:ring-black/40" aria-label="메뉴 열기">
    <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"/>
    </svg>
  </button>
</header>

<div id="chat-container" class="flex-1 p-4 overflow-y-auto space-y-4">
  <div class="msg-row ai">
    <div class="avatar" aria-hidden="true">
      <img src="https://hyesugi.com/hyesugi.jpg" alt="혜숙이 프로필">
    </div>
    <div class="bubble bubble-ai">
      <p class="text-gray-800">안녕? 무슨 고민 있어? 말해봐 들어줄게</p>
    </div>
  </div>
</div>

<div id="loading" class="hidden flex items-center justify-start p-4">
  <div class="flex items-center space-x-2">
    <div class="bg-white rounded-lg p-3 shadow flex items-center space-x-2">
      <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: -0.3s;"></div>
      <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: -0.15s;"></div>
      <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
    </div>
  </div>
</div>

<footer id="chat-footer" class="p-4 bg-white/30 backdrop-blur-sm">
  <div class="relative flex items-center">
    <input type="text" id="user-input" class="w-full bg-white rounded-full py-2 pl-5 pr-14 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400 shadow-inner" placeholder="메시지를 입력하세요...">
    <button id="send-button" class="absolute right-2 top-1/2 -translate-y-1/2 w-9 h-9 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
    </button>
  </div>
</footer>
</div>

<div id="drawer-overlay" class="fixed inset-0 bg-black/30 hidden z-40"></div>
<aside id="drawer" class="fixed right-0 top-0 h-full w-1/2 max-w-md bg-white shadow-xl translate-x-full transition-transform duration-300 z-50">
  <div class="flex items-center justify-between p-4 border-b">
    <h2 class="font-bold text-gray-800">메뉴</h2>
    <button id="drawer-close" class="p-2 rounded-md hover:bg-gray-100" aria-label="메뉴 닫기">
      <svg class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>
  <nav class="p-4 space-y-2">
    <a href="luck" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">위로와 행운</a>
    <a href="fate" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">사주와 궁합</a>
    <a href="facereading" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 관상은</a>
    <a href="handreading" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">나의 손금은</a>
    <a href="board" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">익명 게시판</a>
    <a href="expert" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">전문가 상담</a>
    <a href="solo" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">솔로는 여기</a>
    <a href="money" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">돈되는 정보</a>
    <a href="game" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">신나는 게임</a>
    <a href="https://hyesugi.com/tube" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">혜숙이 튜브</a>
    <a href="https://hyesugi.com/horror" class="block px-3 py-2 rounded-lg hover:bg-gray-100" style="font-family: 'Gungsuh', '궁서', serif; color: red;">공포 게임</a>
    <a href="info" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">이용 안내</a>
    <a href="#" id="share-btn" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-800">공유하기</a>
  </nav>
</aside>

  <script>
// === Drawer (햄버거 메뉴) 토글 ===
(function () {
  const drawer = document.getElementById('drawer');
  const overlay = document.getElementById('drawer-overlay');
  const menuBtn = document.getElementById('menu-btn');
  const closeBtn = document.getElementById('drawer-close');

  const openDrawer = () => {
    drawer.classList.remove('translate-x-full');
    overlay.classList.remove('hidden');
  };
  const closeDrawer = () => {
    drawer.classList.add('translate-x-full');
    overlay.classList.add('hidden');
  };

  menuBtn?.addEventListener('click', openDrawer);
  closeBtn?.addEventListener('click', closeDrawer);
  overlay?.addEventListener('click', closeDrawer);

  // ESC로 닫기
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeDrawer();
  });

  // 드로어 안의 링크 클릭 시 자동 닫기
  document.querySelectorAll('#drawer a').forEach((a) => {
    a.addEventListener('click', closeDrawer);
  });

  // 공유하기 버튼
  const shareBtn = document.getElementById('share-btn');
  if (shareBtn) {
    shareBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      const shareData = {
        title: document.title || 'hyesugi.com',
        url: location.href
      };
      try {
        if (navigator.share) {
          await navigator.share(shareData);
        } else {
          await navigator.clipboard.writeText(shareData.url);
          const orig = shareBtn.textContent;
          shareBtn.textContent = '링크 복사됨!';
          setTimeout(() => (shareBtn.textContent = orig || '공유하기'), 1500);
        }
      } catch (_) {
        // 사용자가 공유 취소한 경우 등은 무시
      } finally {
        closeDrawer();
      }
    });
  }
})();
</script>


<script>
// === 추가: AI 답변 내 링크 자동 변환 유틸 ===
function safeLinkify(text) {
  const esc = (s) => s
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');

  let out = esc(text);
  out = out.replace(/(^|\s)(www\.[^\s<]+)(?=$|\s)/gi, (m, pre, url) => {
    const href = `https://${url}`;
    return `${pre}<a href="${href}" target="_blank" rel="noopener noreferrer" class="underline break-words">${url}</a>`;
  });
  out = out.replace(/(https?:\/\/[^\s<]+)(?=$|\s)/gi, (url) => {
    return `<a href="${url}" target="_blank" rel="noopener noreferrer" class="underline break-words">${url}</a>`;
  });
  return out;
}

const chatContainer = document.getElementById('chat-container');
const userInput = document.getElementById('user-input');
const sendButton = document.getElementById('send-button');
const loadingIndicator = document.getElementById('loading');
let conversationHistory = [];

function addMessageToChat(message, sender) {
  const row = document.createElement('div');
  row.className = `msg-row ${sender === 'user' ? 'user' : 'ai'}`;
  const avatar = document.createElement('div');
  avatar.className = 'avatar ' + (sender === 'user' ? 'avatar-user' : '');
  if (sender === 'user') {
    avatar.textContent = '나';
  } else {
    const img = document.createElement('img');
    img.src = 'https://hyesugi.com/hyesugi.jpg';
    img.alt = '혜숙이 프로필';
    avatar.appendChild(img);
  }

  const bubble = document.createElement('div');
  bubble.className = `bubble ${sender === 'user' ? 'bubble-user' : 'bubble-ai'}`;
  if (sender === 'user') bubble.innerText = message;
  else bubble.innerHTML = safeLinkify(message);

  if (sender === 'user') {
    row.appendChild(bubble);
    row.appendChild(avatar);
  } else {
    row.appendChild(avatar);
    row.appendChild(bubble);
  }

  chatContainer.appendChild(row);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

async function getAIResponse() {
  const userMessage = userInput.value.trim();
  if (!userMessage) return;

  addMessageToChat(userMessage, 'user');
  conversationHistory.push({ role: 'user', content: userMessage });
  userInput.value = '';
  loadingIndicator.classList.remove('hidden');

  try {
    const response = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: conversationHistory })
    });

    const raw = await response.text();
    let data = null;
    try { data = JSON.parse(raw); } catch {}
    if (!response.ok) {
      console.error('DeepSeek error:', response.status, raw);
      addMessageToChat(`에휴.. (${response.status}) 오류. 콘솔 확인해봐.`, 'ai');
      return;
    }
    const choice = data?.choices?.[0];
    const msg = choice?.message || {};
    const finalText = (msg.content || '').trim();
    addMessageToChat(finalText || '음.. 다시 시도해봐.', 'ai');
    conversationHistory.push({ role: 'assistant', content: finalText || '' });
  } catch (err) {
    console.error(err);
    addMessageToChat('에휴.. 네트워크 터졌나봐. 잠깐 뒤에 다시.', 'ai');
  } finally {
    loadingIndicator.classList.add('hidden');
  }
}

sendButton.addEventListener('click', getAIResponse);
userInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    getAIResponse();
  }
});
</script>

<footer id="site-footer" class="text-center text-sm text-gray-700 py-6 space-y-2">
  <div>
    <a href="https://hyesugi.com/donation" target="_blank" rel="noopener noreferrer"
       class="text-black font-semibold hover:underline">
       혜숙이에게 커피 한잔 사주기 ☕
    </a>
  </div>
  <hr class="border-t border-gray-300 opacity-50 w-2/3 mx-auto">
  <div id="ad-slot"></div>
</footer>

<script>
  const ads = [
    { text: "인터넷 바꾸면 47만원 지급해드려요!", url: "https://iryan.kr/t73750ushf" },
    { text: "1시간 투자, 월평균 148만원 버는 고효율 부업", url: "https://iryan.kr/t738hkv2k0" },
    { text: "넷플릭스 글로벌 컨텐츠 잠금해제하는 방법", url: "https://hyesugi.com/vpn" },
    { text: "인간으로 살아남기", url: "https://hyesugi.com/world" }
  ];
  const pick = ads[Math.floor(Math.random() * ads.length)];
  const slot = document.getElementById("ad-slot");
  if (slot) {
    const a = document.createElement("a");
    a.href = pick.url;
    a.target = "_blank";
    a.rel = "noopener noreferrer";
    a.className = "text-blue-600 font-bold underline";
    a.textContent = pick.text;
    slot.replaceChildren(a);
  }
</script>
</body>
</html>

